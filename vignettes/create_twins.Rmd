---
title: "Create Twins"
author: "Richel J.C. Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Create Twins}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## 1. Goal

This vignette shows how `raket` (and `razzo`) 
create twin trees and twin alignments.

## 2 Experiment

## 2.1 Setup

Load the libraries needed:

```{r}
library(pirouette)
```

## 2.2 Create a true tree

Assume a true tree is generated by a run of the `mbd` or `PBD` package.
Both models share two parameters with the BD model: a speciation 
rate and extinction rate.

```{r}
extinction_rate <- 0.1
```

Create a true tree (note how it follows both the PBD and MBD model):

```{r}
true_tree <- ape::read.tree(text = "((A:12, B:12):3, (C:12, D:12):3);")
#babette::plot_densitree(c(true_tree))
```

## 2.3 Estimate speciation rate

Here we use the `mbd` packages maximum likelihood estimator,
to obtain the speciation rate with the highest likelihood in a
(normal) birth-death model. 

```{r}
ml_est <- becosys::mbd_calc_max_lik(
  branching_times = ape::branching.times(true_tree),
  init_param_values = becosys::create_mbd_params(
    lambda = 0.1, 
    mu = extinction_rate, 
    nu = 0.0, 
    q = 0.0
  ),
  fixed_params = becosys::create_mbd_params_selector(mu = TRUE, nu = TRUE, q = TRUE),
  opt_params = becosys::create_mbd_params_selector(lambda = TRUE),
  init_n_species = 2
)
ml_est
```

