---
title: "Model Comparison"
author: "Richel J.C. Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{Model Comparison}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


## Goal

To see how the Bayesian comparison between JC69 and GTR must look like.

Instead of starting from the speciation
initiation and speciation completion rate, we start from:

 * the expected mean number of species must be 50, 100 and 200
 * the extinction rates are 0.3 and 0.5
 * the speciation completion rates are 0.1, 0.3, 1.0 and Infinite

```{r}
# Extinction rates
ers <- c(0.0, 0.1, 0.2)

# Number of species
ns <- c(50, 100, 200)

# Speciation completion rate
scrs <- c(0.1, 0.3, 1.0, 1e9)

# Replicate index (human counting)
reps <- seq(1, 10)
```

Each of these parameter setups has replicates, each of which compares JC69 and GTR by a Bayes factor:

```{r}
df <- expand.grid(er = ers, n = ns, scr = scrs, rep = reps)

# Bayes factor
df$bf <- "?"
knitr::kable(head(df))
```

Bayes factors go from zero to infinite, exclusing zero. Here I will look from
a JC69 perspective, the actual generative model:

```{r}
interpret_bayes_factor <- function(bayes_factor) {
  if (bayes_factor < 10^-2.0) {
    "decisive for GTR"
  } else if (bayes_factor < 10^-1.5) {
    "very strong for GTR"
  } else if (bayes_factor < 10^-1.0) {
    "strong for GTR"
  } else if (bayes_factor < 10^-0.5) {
    "substantial for GTR"
  } else if (bayes_factor < 10^0.0) {
    "barely worth mentioning for GTR"
  } else if (bayes_factor < 10^0.5) {
    "barely worth mentioning for JC69"
  } else if (bayes_factor < 10^1.0) {
    "substantial for JC69"
  } else if (bayes_factor < 10^1.5) {
    "strong for JC69"
  } else if (bayes_factor < 10^2.0) {
    "very strong for JC69"
  } else {
    "decisive for JC69"
  }
}
testit::assert(interpret_bayes_factor(1 / 123.0) == "decisive for GTR")
testit::assert(interpret_bayes_factor(1 / 85.0) == "very strong for GTR")
testit::assert(interpret_bayes_factor(1 / 12.5) == "strong for GTR")
testit::assert(interpret_bayes_factor(1 / 8.5) == "substantial for GTR")
testit::assert(interpret_bayes_factor(1 / 1.5) == "barely worth mentioning for GTR")
testit::assert(interpret_bayes_factor(0.99) == "barely worth mentioning for GTR")
testit::assert(interpret_bayes_factor(1.01) == "barely worth mentioning for JC69")
testit::assert(interpret_bayes_factor(1.5) == "barely worth mentioning for JC69")
testit::assert(interpret_bayes_factor(8.5) == "substantial for JC69")
testit::assert(interpret_bayes_factor(12.5) == "strong for JC69")
testit::assert(interpret_bayes_factor(85.0) == "very strong for JC69")
testit::assert(interpret_bayes_factor(123.0) == "decisive for JC69")
```

I will initialize random Bayes factor in an overly simple way:

```{r}
df$bf <- runif(n = nrow(df))
```

I will add an interpretation:

```{r}
df$bfi <- "?"
for (row in seq(1, nrow(df)))
{
  df$bfi[row] <- interpret_bayes_factor(df$bf[row])
}
df$bfi <- as.factor(df$bfi)
```

Our full data frame becomes:

```{r}
knitr::kable(head(df))
```

Putting this in a plot:

```{r fig.width = 7}
is.factor(df$bfi)
library(ggplot2)
ggplot(
  data = df,
  aes(x = as.factor(scr), fill = bfi)
) + geom_bar() + facet_grid(as.factor(n) ~ as.factor(er)) + 
  ggtitle("How often is which model favored?")
```